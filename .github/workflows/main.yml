name: Selenium Tests on Windows

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    runs-on: windows-latest

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ”§ Set Up JDK 21
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '21'
          cache: 'maven'

      - name: ðŸ–¥ Install Chrome, Firefox, and Edge via Chocolatey
        run: |
          choco install googlechrome -y
          choco install firefox -y
          choco install microsoft-edge -y

      - name: ðŸ”¥ Install ChromeDriver
        run: |
          $ChromeDriverVersion = (Invoke-WebRequest -Uri "https://chromedriver.storage.googleapis.com/LATEST_RELEASE").Content.Trim()
          Invoke-WebRequest -Uri "https://chromedriver.storage.googleapis.com/$ChromeDriverVersion/chromedriver_win32.zip" -OutFile chromedriver.zip
          Expand-Archive -Path chromedriver.zip -DestinationPath .
          Move-Item -Path chromedriver.exe -Destination "C:\Program Files\Google\Chrome\Application"
          [Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\Program Files\Google\Chrome\Application", [System.EnvironmentVariableTarget]::Machine)

      - name: ðŸ”¥ Install fixed GeckoDriver
        run: |
          $GeckoDriverVersion = (Invoke-WebRequest -Uri "https://api.github.com/repos/mozilla/geckodriver/releases/latest" | ConvertFrom-Json).tag_name
          Invoke-WebRequest -Uri "https://github.com/mozilla/geckodriver/releases/download/$GeckoDriverVersion/geckodriver-v$GeckoDriverVersion-win64.zip" -OutFile geckodriver.zip
          Expand-Archive -Path geckodriver.zip -DestinationPath .
          Move-Item -Path geckodriver.exe -Destination "C:\Program Files\Mozilla Firefox"
          [Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\Program Files\Mozilla Firefox", [System.EnvironmentVariableTarget]::Machine)

      - name: ðŸ”¥ Install EdgeDriver
        run: |
          Invoke-WebRequest -Uri "https://msedgedriver.azureedge.net/LATEST_STABLE/msedgedriver_win64.zip" -OutFile edgedriver.zip
          Expand-Archive -Path edgedriver.zip -DestinationPath .
          Move-Item -Path msedgedriver.exe -Destination "C:\Program Files (x86)\Microsoft\Edge\Application"
          [Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\Program Files (x86)\Microsoft\Edge\Application", [System.EnvironmentVariableTarget]::Machine)

      - name: ðŸš€ Run Selenium Tests
        run: mvn clean test
